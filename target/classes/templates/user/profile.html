<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      th:include="layout :: page" lang="en">
<head>
    <meta charset="UTF-8">
    <title th:text="${user.username} profile"></title>
</head>
<body>
<div th:fragment="content">
    <div style="margin-top: 5%" class="container-fluid bg-body">
        <div class="container">
            <p class="h1" th:text="'Profile for user: '+${user.username}"></p>
            <a th:if="${currentUser == null or currentUser.id == user.id}" th:href="@{/profile/edit}"> Edit</a>
        </div>
        <table class="table table-hover">
            <tbody th:each="task : ${tasks}">
            <tr class="table-primary"
                th:if="${task.parentTask} == null">
                <th scope="row">Task</th>
                <td><a class="navbar-brand" th:href="|@{/tasks/}${task.getId()}|"
                       th:text="${task.task.name}"></a></td>
                <td>
                    <p th:if="${task.task.modifiable}" th:text="'Status: '+${task.task.status.status}"></p>
                    <div th:text="|${task.task.isOverdue() ? '(Overdue) ' : ' '}${task.isActive() ? '(Active)' : ''}|"></div>
                </td>
                <td>
                    <div th:text="${task.getActiveTime()}"></div>
                </td>
                <td>
                    <p th:if="${user.id != task.task.createdBy.id and task.task.id != 1}"
                       th:text="'Assigned by: '+${task.task.createdBy.username}"></p>
                </td>
                <td>
                    <a th:if="${task.task.modifiable} and ${currentUser == null or currentUser.id == user.id or task.task.createdBy.id == currentUser.id}"
                       th:href="|@{/tasks/save?id=}${task.id}|">Edit</a></td>
                <td>
                    <form th:if="${task.task.modifiable} and ${currentUser == null or currentUser.id == user.id or task.task.createdBy.id == currentUser.id}"
                          th:method="POST" th:action="@{/tasks/delete}">
                        <input th:value="${task.id}" name="task" hidden>
                        <input type="submit" value="Delete">
                    </form>
                </td>
                <td>
                    <form th:if="${currentUser == null or currentUser.id == user.id}"
                          th:unless="${task.isActive()}" th:method="POST" th:action="@{/tasks/active}">
                        <input th:value="${task.id}" name="task" hidden>
                        <input type="submit" value="Set active">
                    </form>
                </td>
                <td th:if="${currentUser == null or currentUser.id == user.id}">
                    <a th:href="|@{/tasks/save?parent=}${task.getId()}|">
                        Create subtask
                    </a>
                </td>
            </tr>
            <tr class="table-secondary" th:each="subtask : ${task.getChildrenTasks()}">
                <th scope="row">Subtask</th>
                <td><a class="navbar-brand" th:href="|@{/tasks/}${subtask.getId()}|"
                       th:text="${subtask.task.name}"></a></td>
                <td>
                    <p th:text="'Status: '+${subtask.task.status.status}"></p>
                    <div th:text="|${subtask.task.isOverdue() ? '(Overdue) ' : ' '}${subtask.isActive() ? '(Active)' : ''}|"></div>
                </td>
                <td>
                    <div th:text="${subtask.getActiveTime()}"></div>
                </td>
                <td>
                    <p th:if="${user.id != subtask.task.createdBy.id and subtask.task.id != 1}"
                       th:text="'Assigned by: '+${subtask.task.createdBy.username}"></p>
                </td>
                <td>
                    <a th:if="${subtask.task.modifiable} and ${currentUser == null or currentUser.id == user.id or subtask.task.createdBy.id == currentUser.id}"
                       th:href="|@{/tasks/save?id=}${subtask.id}|">Edit</a>
                <td>
                    <form th:if="${subtask.task.modifiable} and ${currentUser == null or currentUser.id == user.id or subtask.task.createdBy.id == currentUser.id}"
                          th:method="POST" th:action="@{/tasks/delete}">
                        <input th:value="${subtask.id}" name="task" hidden>
                        <input type="submit" value="Delete">
                    </form>
                </td>
                <td>
                    <form th:if="${currentUser == null or currentUser.id == user.id}"
                          th:unless="${subtask.isActive()}" th:method="POST"
                          th:action="@{/tasks/active}">
                        <input th:value="${subtask.id}" name="task" hidden>
                        <input type="submit" value="Set active">
                    </form>
                </td>
                <td></td>
            </tr>
            </tbody>
        </table>
        <a th:if="${currentUser == null or currentUser.id == user.id}" th:href="@{/tasks/save}">Create new task</a>
        <a th:if="${currentUser != null}" th:href="|@{/admin/users/}${user.id}@{/assign}|">Assign task</a>
    </div>
</div>
</body>
</html>