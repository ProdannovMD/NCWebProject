<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:include="layout :: page" lang="en">
<head>
    <meta charset="UTF-8">
    <title th:text="${user.username} profile"></title>
</head>
<body>
<div th:fragment="content">
    <div style="margin-top: 5%" class="container-fluid bg-body">
        <div class="container">
            <p class="h1" th:text="${user.username}"></p>
        </div>
        <ul class="list-group">
            <li class="list-group-item list-group-item-primary list-group-item-action" th:each="task : ${tasks}" th:if="${task.parentTask} == null">
                <div class="container-fluid d-inline-block">
                    <a class="navbar-brand" th:href="|@{/profile/tasks/}${task.getId()}|" th:text="${task.task.name}"></a>
                    <div th:text="${task.getActiveTime()}"></div>
                    <div th:if="${task.isActive()}">Active</div>
                    <a th:if="${task.task.modifiable}" th:href="|@{/profile/tasks/save?id=}${task.id}|">Edit</a>
                    <form th:if="${task.task.modifiable}" th:method="POST" th:action="@{/profile/tasks/delete}">
                        <input th:value="${task.id}" name="task" hidden>
                        <input type="submit" value="Delete">
                    </form>
                    <form th:unless="${task.isActive()}" th:method="POST" th:action="@{/profile/tasks/active}">
                        <input th:value="${task.id}" name="task" hidden>
                        <input type="submit" value="Set active">
                    </form>
                    <a th:href="|@{/profile/tasks/save?parent=}${task.getId()}|">Create subtask</a>
                </div>
                <div>
                    <ul class="list-group">
                        <li class="list-group-item list-group-item-action" th:each="subtask : ${task.getChildrenTasks()}">
                            <div>
                                <a th:href="|@{/profile/tasks/}${subtask.getId()}|" th:text="${subtask.task.name}"></a>
                                <div th:text="${subtask.getActiveTime()}"></div>
                                <div th:if="${subtask.isActive()}">Active</div>
                                <a th:if="${subtask.task.modifiable}" th:href="|@{/profile/tasks/save?id=}${subtask.id}|">Edit</a>
                                <form th:if="${subtask.task.modifiable}" th:method="POST" th:action="@{/profile/tasks/delete}">
                                    <input th:value="${subtask.id}" name="task" hidden>
                                    <input type="submit" value="Delete">
                                </form>
                                <form th:unless="${subtask.isActive()}" th:method="POST"
                                      th:action="@{/profile/tasks/active}">
                                    <input th:value="${subtask.id}" name="task" hidden>
                                    <input type="submit" value="Set active">
                                </form>
                            </div>
                        </li>
                    </ul>
                </div>
            </li>
            <a th:href="@{/profile/tasks/save}">Create new task</a>
        </ul>
    </div>
</body>
</html>